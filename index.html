<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BishesAI Premium</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { overflow: hidden; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
</style>

</head>

<body class="bg-gray-950 text-gray-100 h-screen flex">

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="w-full flex items-center justify-center bg-gradient-to-br from-indigo-600 to-purple-600">
  <div class="bg-gray-900 p-8 rounded-xl shadow-2xl text-center w-96">
    <h2 class="text-2xl font-bold mb-6">BishesAI Premium</h2>
    <button onclick="googleLogin()" 
      class="bg-white text-black px-6 py-3 rounded-lg w-full font-semibold hover:scale-105 transition">
      Continue with Google
    </button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden w-full flex">

  <!-- SIDEBAR -->
  <div class="w-72 bg-gray-900 border-r border-gray-800 flex flex-col">

    <div class="p-4 flex items-center gap-3 border-b border-gray-800">
      <img id="userPhoto" class="w-8 h-8 rounded-full">
      <span id="userName" class="text-sm"></span>
    </div>

    <button onclick="newChat()" 
      class="m-4 bg-indigo-600 hover:bg-indigo-700 p-2 rounded-lg">
      + New Chat
    </button>

    <div id="chatList" class="flex-1 overflow-y-auto px-3 space-y-2"></div>

    <div class="p-4 border-t border-gray-800 text-sm flex justify-between">
      <button onclick="openSettings()" class="hover:text-indigo-400">API</button>
      <button onclick="logout()" class="text-red-400 hover:underline">Logout</button>
    </div>
  </div>

  <!-- CHAT AREA -->
  <div class="flex-1 flex flex-col">

    <div class="p-4 border-b border-gray-800 bg-gray-900">
      <select id="modelSelect" class="bg-gray-800 p-2 rounded">
        <option value="gpt-4o-mini">gpt-4o-mini</option>
        <option value="gpt-4">gpt-4</option>
      </select>
    </div>

    <div id="chatBox" class="flex-1 overflow-y-auto p-6 space-y-6"></div>

    <div class="p-4 bg-gray-900 border-t border-gray-800 flex gap-3">
      <input id="userInput" type="text" placeholder="Send a message..."
        class="flex-1 bg-gray-800 p-3 rounded-lg focus:outline-none">
      <button onclick="sendMessage()" 
        class="bg-indigo-600 hover:bg-indigo-700 px-6 rounded-lg">
        Send
      </button>
    </div>

  </div>
</div>

<!-- API SETTINGS MODAL -->
<div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center">
  <div class="bg-gray-900 p-6 rounded-xl w-96 border border-gray-700">
    <h3 class="text-lg font-bold mb-4">API Settings</h3>
    <input id="apiEndpoint" placeholder="API Endpoint"
      class="w-full mb-3 p-2 bg-gray-800 rounded">
    <input id="apiKey" placeholder="API Key"
      class="w-full mb-4 p-2 bg-gray-800 rounded">
    <div class="flex justify-end gap-3">
      <button onclick="saveSettings()" class="bg-indigo-600 px-4 py-2 rounded">Save</button>
      <button onclick="closeSettings()" class="bg-gray-700 px-4 py-2 rounded">Cancel</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDAztxs1Nq-Z5I_aO3QeYZZ7lFlr7qZpok",
  authDomain: "bishesai.firebaseapp.com",
  projectId: "bishesai",
  storageBucket: "bishesai.firebasestorage.app",
  messagingSenderId: "715871264430",
  appId: "1:715871264430:web:5596ab19535688527f973f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

window.googleLogin = async () => {
  try { await signInWithPopup(auth, provider); }
  catch (e) { alert(e.message); }
};

window.logout = async () => {
  await signOut(auth);
  location.reload();
};

let chats = [];
let currentChat = null;
let currentUserId = null;

onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUserId = user.uid;
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("userName").innerText = user.displayName;
    document.getElementById("userPhoto").src = user.photoURL;
    loadChats();
  }
});

function saveChats(){
  localStorage.setItem("chats_" + currentUserId, JSON.stringify(chats));
}

function loadChats(){
  chats = JSON.parse(localStorage.getItem("chats_" + currentUserId)) || [];
  renderChats();
}

window.newChat = function(){
  const chat = { id: Date.now(), name: "New Chat", messages: [] };
  chats.push(chat);
  currentChat = chat;
  saveChats();
  renderChats();
  renderMessages();
};

function renderChats(){
  const list = document.getElementById("chatList");
  list.innerHTML = "";
  chats.forEach(chat=>{
    const div = document.createElement("div");
    div.className="p-2 rounded hover:bg-gray-800 cursor-pointer";
    div.innerText=chat.name;
    div.onclick=()=>{ currentChat=chat; renderMessages(); };
    list.appendChild(div);
  });
}

function renderMessages(){
  const box = document.getElementById("chatBox");
  box.innerHTML="";
  if(!currentChat) return;
  currentChat.messages.forEach(msg=>{
    const div=document.createElement("div");
    div.className= msg.role==="user" ? "text-right" : "text-left";
    div.innerHTML=`
      <div class="inline-block px-4 py-3 rounded-2xl max-w-xl
      ${msg.role==="user"?"bg-indigo-600":"bg-gray-800"}">
      ${msg.content}
      </div>`;
    box.appendChild(div);
  });
  box.scrollTop = box.scrollHeight;
}

window.sendMessage = async function(){
  const input=document.getElementById("userInput");
  if(!input.value.trim()||!currentChat) return;

  const text=input.value;
  input.value="";
  currentChat.messages.push({role:"user",content:text});
  renderMessages();

  const endpoint=localStorage.getItem("apiEndpoint");
  const key=localStorage.getItem("apiKey");
  const model=document.getElementById("modelSelect").value;

  const res=await fetch(endpoint,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+key
    },
    body:JSON.stringify({
      model:model,
      messages:currentChat.messages
    })
  });

  const data=await res.json();
  const reply=data.choices?.[0]?.message?.content || "No response";

  currentChat.messages.push({role:"assistant",content:reply});
  saveChats();
  renderMessages();
};

window.openSettings = function(){
  document.getElementById("settingsModal").classList.remove("hidden");
};

window.closeSettings = function(){
  document.getElementById("settingsModal").classList.add("hidden");
};

window.saveSettings = function(){
  localStorage.setItem("apiEndpoint",document.getElementById("apiEndpoint").value);
  localStorage.setItem("apiKey",document.getElementById("apiKey").value);
  closeSettings();
};
</script>

</body>
</html>


